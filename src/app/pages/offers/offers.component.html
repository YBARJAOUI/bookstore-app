<div class="offers-page">
  <div class="container">
    <div class="page-header">
      <h1>Offres du moment</h1>
      <p>Profitez des remises limit√©es et des offres exclusives</p>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="error">
      {{ error }}
      <button class="close-error" (click)="error = ''">√ó</button>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" *ngIf="loading">
      <div class="spinner"></div>
      <p>Chargement des offres...</p>
    </div>

    <!-- Daily Offers Section -->
    <div class="section" *ngIf="!loading && dailyOffers.length > 0">
      <div class="section-header">
        <h2>üî• Offres quotidiennes</h2>
        <p>Promotions limit√©es dans le temps</p>
      </div>
      
      <div class="daily-offers-grid">
        <div *ngFor="let offer of dailyOffers" class="daily-offer-card" [class.expired]="!isOfferValid(offer)">
          <!-- Offer Image -->
          <div class="offer-image" *ngIf="offer.image">
            <img [src]="offer.image" [alt]="offer.title" />
            <div class="discount-badge" *ngIf="offer.discountPercentage">
              -{{ offer.discountPercentage }}%
            </div>
          </div>
          
          <!-- Offer Content -->
          <div class="offer-content">
            <h3>{{ offer.title }}</h3>
            <p>{{ offer.description }}</p>
            
            <!-- Pricing -->
            <div class="offer-pricing">
              <span class="offer-price">{{ offer.offerPrice }} MAD</span>
              <span class="original-price">{{ offer.originalPrice }} MAD</span>
              <span class="savings">
                √âconomisez {{ calculateSavings(offer.originalPrice, offer.offerPrice) }} MAD
              </span>
            </div>
            
            <!-- Product Info -->
            <div class="product-info" *ngIf="offer.book || offer.pack">
              <div *ngIf="offer.book" class="product-type">
                üìñ Livre: {{ offer.book.title }}
              </div>
              <div *ngIf="offer.pack" class="product-type">
                üì¶ Pack: {{ offer.pack.name }}
              </div>
            </div>
            
            <!-- Time Remaining -->
            <div class="time-remaining" *ngIf="isOfferValid(offer)">
              <span class="timer-icon">‚è∞</span>
              Plus que {{ getDaysRemaining(offer.endDate) }} jour(s) !
            </div>
            
            <!-- Quantity Info -->
            <div class="quantity-info" *ngIf="offer.limitQuantity">
              <div class="stock-bar">
                <div class="stock-progress" 
                     [style.width.%]="((offer.limitQuantity - (offer.soldQuantity || 0)) / offer.limitQuantity) * 100">
                </div>
              </div>
              <span class="stock-text">
                {{ offer.limitQuantity - (offer.soldQuantity || 0) }} / {{ offer.limitQuantity }} disponibles
              </span>
            </div>
            
            <!-- Action Button -->
            <div class="offer-actions">
              <button class="btn btn-primary" 
                      [disabled]="!isOfferValid(offer) || (offer.limitQuantity && (offer.soldQuantity || 0) >= offer.limitQuantity)"
                      (click)="loadOffersAndPacks()">
                {{ isOfferValid(offer) ? "J'en profite" : "Offre expir√©e" }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Packs Section -->
    <div class="section" *ngIf="!loading && packs.length > 0">
      <div class="section-header">
        <h2>üì¶ Nos packs exclusifs</h2>
        <p>Des collections sp√©cialement s√©lectionn√©es pour vous</p>
      </div>
      
      <div class="packs-grid">
        <div *ngFor="let pack of packs" class="pack-card" [class.featured]="pack.isFeatured">
          <!-- Pack Image -->
          <div class="pack-image" *ngIf="pack.imageUrl">
            <img [src]="pack.imageUrl" [alt]="pack.name" />
            <div class="featured-badge" *ngIf="pack.isFeatured">‚≠ê Vedette</div>
          </div>
          
          <!-- Pack Content -->
          <div class="pack-content">
            <h3>{{ pack.name }}</h3>
            <p>{{ pack.description }}</p>
            
            <!-- Pack Info -->
            <div class="pack-info">
              <div class="pack-price">
                <span class="current-price">{{ pack.price }} MAD</span>
              </div>
              
              <div class="pack-category" *ngIf="pack.category">
                <span class="category-badge">{{ pack.category }}</span>
              </div>
              
              <div class="pack-stock" *ngIf="pack.stockQuantity !== undefined">
                <span [class.low-stock]="pack.stockQuantity < 5" [class.out-of-stock]="pack.stockQuantity === 0">
                  {{ pack.stockQuantity > 0 ? pack.stockQuantity + ' en stock' : 'Rupture de stock' }}
                </span>
              </div>
            </div>
            
            <!-- Action Button -->
            <div class="pack-actions">
              <button class="btn btn-primary" 
                      [disabled]="!pack.isActive || pack.stockQuantity === 0"
                      (click)="loadOffersAndPacks()">
                {{ pack.stockQuantity === 0 ? 'Rupture de stock' : 'Voir le pack' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- No Content Message -->
    <div class="no-content" *ngIf="!loading && dailyOffers.length === 0 && packs.length === 0">
      <div class="no-content-message">
        <span class="no-content-icon">üéÅ</span>
        <h3>Aucune offre disponible pour le moment</h3>
        <p>Revenez bient√¥t pour d√©couvrir nos nouvelles promotions !</p>
        <a routerLink="/all-books" class="btn btn-primary">Voir tous les livres</a>
      </div>
    </div>

    <!-- Info Section -->
    <div class="offers-info" *ngIf="!loading && (dailyOffers.length > 0 || packs.length > 0)">
      <div class="info-card">
        <h3>Conditions des offres</h3>
        <ul>
          <li>üéØ Offres valables dans la limite des stocks disponibles</li>
          <li>üì¶ Livraison rapide partout au Maroc</li>
          <li>üéÅ Offres non cumulables avec d'autres promotions</li>
          <li>üí≥ Paiement s√©curis√© √† la livraison</li>
          <li>üìû Service client disponible pour vous accompagner</li>
        </ul>
      </div>
    </div>
  </div>
</div>

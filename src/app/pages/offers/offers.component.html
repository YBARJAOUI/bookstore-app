<div class="offers-page" dir="rtl">
  <div class="container">
    <!-- ุนููุงู ุงูุตูุญุฉ -->
    <div class="page-header">
      <h1>ุงูุนุฑูุถ ุงูุฎุงุตุฉ</h1>
      <p>ุงูุชุดู ุฃูุถู ุงูุตููุงุช ูุงูุนุฑูุถ ุงููุญุฏูุฏุฉ ุงูููุช</p>
    </div>

    <!-- ุฑุณุงุฆู ุงูุฎุทุฃ -->
    <div class="error-message" *ngIf="error">
      {{ error }}
      <button class="close-error" (click)="error = ''">ร</button>
    </div>

    <!-- ุญุงูุฉ ุงูุชุญููู -->
    <div class="loading-spinner" *ngIf="loading">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุชุญููู ุงูุนุฑูุถ...</p>
    </div>

    <!-- ุงูุนุฑูุถ ุงูููููุฉ -->
    <div class="section" *ngIf="!loading && dailyOffers.length > 0">
      <div class="section-header">
        <h2>๐ฅ ุนุฑูุถ ุงูููู</h2>
        <p>ุนุฑูุถ ูุญุฏูุฏุฉ ุงูููุช - ูุง ุชููุชูุง!</p>
      </div>
      
      <div class="offers-grid">
        <div *ngFor="let offer of dailyOffers" class="offer-card" [class.expired]="!isOfferValid(offer)">
          <!-- ุตูุฑุฉ ุงูุนุฑุถ -->
          <div class="offer-image" *ngIf="offer.image">
            <img [src]="offer.image" [alt]="offer.title" />
            <div class="discount-badge" *ngIf="offer.discountPercentage">
              -{{ offer.discountPercentage }}%
            </div>
            <div class="countdown-badge" *ngIf="isOfferValid(offer)">
              {{ getDaysRemaining(offer.endDate) }} ููู ูุชุจูู
            </div>
          </div>
          
          <!-- ูุญุชูู ุงูุนุฑุถ -->
          <div class="offer-content">
            <h3>{{ offer.title }}</h3>
            <p>{{ offer.description }}</p>
            
            <!-- ุงูุฃุณุนุงุฑ -->
            <div class="offer-pricing">
              <div class="price-row">
                <span class="offer-price">{{ offer.offerPrice }} ุฏุฑูู</span>
                <span class="original-price">{{ offer.originalPrice }} ุฏุฑูู</span>
              </div>
              <div class="savings">
                ููุฑ {{ calculateSavings(offer.originalPrice, offer.offerPrice) }} ุฏุฑูู!
              </div>
            </div>
            
            <!-- ูุนูููุงุช ุงูููุชุฌ -->
            <div class="product-info" *ngIf="offer.book || offer.pack">
              <div *ngIf="offer.book" class="product-type">
                ๐ ูุชุงุจ: {{ offer.book.title }}
              </div>
              <div *ngIf="offer.pack" class="product-type">
                ๐ฆ ุจุงูุฉ: {{ offer.pack.name }}
              </div>
            </div>
            
            <!-- ุงููููุฉ ุงููุชุงุญุฉ -->
            <div class="quantity-info" *ngIf="offer.limitQuantity">
              <div class="stock-bar">
                <div class="stock-progress" 
                     [style.width.%]="((offer.limitQuantity - (offer.soldQuantity || 0)) / offer.limitQuantity) * 100">
                </div>
              </div>
              <span class="stock-text">
                {{ offer.limitQuantity - (offer.soldQuantity || 0) }} / {{ offer.limitQuantity }} ูุชุงุญ
              </span>
            </div>
            
            <!-- ุฒุฑ ุงูุฅุฌุฑุงุก -->
            <div class="offer-actions">
              <button class="btn btn-primary" 
                      [disabled]="!isOfferValid(offer) || (offer.limitQuantity && (offer.soldQuantity || 0) >= offer.limitQuantity)"
                      (click)="selectOffer(offer)">
                {{ isOfferValid(offer) ? "ุงุฎุชุฑ ูุฐุง ุงูุนุฑุถ" : "ุงูุชูู ุงูุนุฑุถ" }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ูุณู ุงูุจุงูุงุช -->
    <div class="section" *ngIf="!loading && packs.length > 0">
      <div class="section-header">
        <h2>๐ฆ ุจุงูุงุชูุง ุงูุญุตุฑูุฉ</h2>
        <p>ูุฌููุนุงุช ูุฎุชุงุฑุฉ ุฎุตูุตุงู ูู</p>
      </div>
      
      <div class="packs-grid">
        <div *ngFor="let pack of packs" class="pack-card" [class.featured]="pack.isFeatured">
          <!-- ุตูุฑุฉ ุงูุจุงูุฉ -->
          <div class="pack-image" *ngIf="pack.imageUrl">
            <img [src]="pack.imageUrl" [alt]="pack.name" />
            <div class="featured-badge" *ngIf="pack.isFeatured">โญ ูููุฒ</div>
          </div>
          
          <!-- ูุญุชูู ุงูุจุงูุฉ -->
          <div class="pack-content">
            <h3>{{ pack.name }}</h3>
            <p>{{ pack.description }}</p>
            
            <!-- ูุนูููุงุช ุงูุจุงูุฉ -->
            <div class="pack-info">
              <div class="pack-price">
                <span class="current-price">{{ pack.price }} ุฏุฑูู</span>
              </div>
              
              <div class="pack-category" *ngIf="pack.category">
                <span class="category-badge">{{ pack.category }}</span>
              </div>
              
              <div class="pack-stock" *ngIf="pack.stockQuantity !== undefined">
                <span [class.low-stock]="pack.stockQuantity < 5" [class.out-of-stock]="pack.stockQuantity === 0">
                  {{ pack.stockQuantity > 0 ? pack.stockQuantity + ' ูุชุงุญ' : 'ููุฏ ุงููุฎุฒูู' }}
                </span>
              </div>
            </div>
            
            <!-- ุฒุฑ ุงูุฅุฌุฑุงุก -->
            <div class="pack-actions">
              <button class="btn btn-primary" 
                      [disabled]="!pack.isActive || pack.stockQuantity === 0"
                      (click)="selectPack(pack)">
                {{ pack.stockQuantity === 0 ? 'ููุฏ ุงููุฎุฒูู' : 'ุงุทูุจ ุงูุจุงูุฉ' }}
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ุฑุณุงูุฉ ุนุฏู ูุฌูุฏ ูุญุชูู -->
    <div class="no-content" *ngIf="!loading && dailyOffers.length === 0 && packs.length === 0">
      <div class="no-content-message">
        <span class="no-content-icon">๐</span>
        <h3>ูุง ุชูุฌุฏ ุนุฑูุถ ูุชุงุญุฉ ุญุงููุงู</h3>
        <p>ุนุฏ ูุฑูุจุงู ูุงูุชุดุงู ุนุฑูุถูุง ุงูุฌุฏูุฏุฉ!</p>
        <a routerLink="/books" class="btn btn-primary">ุชุตูุญ ุฌููุน ุงููุชุจ</a>
      </div>
    </div>

    <!-- ูุนูููุงุช ุงูุนุฑูุถ -->
    <div class="offers-info" *ngIf="!loading && (dailyOffers.length > 0 || packs.length > 0)">
      <div class="info-card">
        <h3>ุดุฑูุท ุงูุนุฑูุถ</h3>
        <ul>
          <li>๐ฏ ุงูุนุฑูุถ ุณุงุฑูุฉ ูู ุญุฏูุฏ ุงููุฎุฒูู ุงููุชุงุญ</li>
          <li>๐ฆ ุชูุตูู ุณุฑูุน ูู ุฌููุน ุฃูุญุงุก ุงููุบุฑุจ</li>
          <li>๐ ุงูุนุฑูุถ ุบูุฑ ูุงุจูุฉ ููุฏูุฌ ูุน ุนุฑูุถ ุฃุฎุฑู</li>
          <li>๐ณ ุฏูุน ุขูู ุนูุฏ ุงูุงุณุชูุงู</li>
          <li>๐ ุฎุฏูุฉ ุงูุนููุงุก ูุชุงุญุฉ ููุณุงุนุฏุชู</li>
        </ul>
      </div>
    </div>

    <!-- ูุงูุฐุฉ ุชุฃููุฏ ุงูุนุฑุถ -->
    <div class="modal" *ngIf="showOfferModal" (click)="closeOfferModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>ุชุฃููุฏ ุงุฎุชูุงุฑ ุงูุนุฑุถ</h2>
        
        <!-- ุชูุงุตูู ุงูุนุฑุถ -->
        <div class="offer-details" *ngIf="selectedOffer">
          <div class="offer-summary">
            <div class="offer-image-small" *ngIf="selectedOffer.image">
              <img [src]="selectedOffer.image" [alt]="selectedOffer.title" />
            </div>
            <div class="offer-info">
              <h3>{{ selectedOffer.title }}</h3>
              <p>{{ selectedOffer.description }}</p>
              <div class="price-info">
                <span class="final-price">{{ selectedOffer.offerPrice }} ุฏุฑูู</span>
                <span class="original-price">ุจุฏูุงู ูู {{ selectedOffer.originalPrice }} ุฏุฑูู</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ุชูุงุตูู ุงูุจุงูุฉ -->
        <div class="pack-details" *ngIf="selectedPack">
          <div class="pack-summary">
            <div class="pack-image-small" *ngIf="selectedPack.imageUrl">
              <img [src]="selectedPack.imageUrl" [alt]="selectedPack.name" />
            </div>
            <div class="pack-info">
              <h3>{{ selectedPack.name }}</h3>
              <p>{{ selectedPack.description }}</p>
              <div class="price-info">
                <span class="final-price">{{ selectedPack.price }} ุฏุฑูู</span>
              </div>
            </div>
          </div>
        </div>

        <!-- ุฑุณุงูุฉ ุงููุฌุงุญ -->
        <div class="success-message" *ngIf="orderSuccess">
          <div class="success-icon">โ</div>
          <h3>ุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ!</h3>
          <p>ุณูุชูุงุตู ูุนู ูุฑูุจุงู ูุชุฃููุฏ ุงูุทูุจ</p>
        </div>

        <!-- ูููุฐุฌ ุงูุทูุจ -->
        <div class="order-form" *ngIf="!orderSuccess">
          <h3>ุฃุฏุฎู ุจูุงูุงุชู ูุฅุชูุงู ุงูุทูุจ</h3>
          
          <div class="form-row">
            <div class="form-group">
              <label for="customerFirstName">ุงูุงุณู ุงูุฃูู *</label>
              <input 
                type="text" 
                id="customerFirstName"
                [(ngModel)]="customerFirstName"
                [disabled]="loading"
                required
                placeholder="ุฃุฏุฎู ุงุณูู ุงูุฃูู"
              >
            </div>
            
            <div class="form-group">
              <label for="customerLastName">ุงุณู ุงูุนุงุฆูุฉ *</label>
              <input 
                type="text" 
                id="customerLastName"
                [(ngModel)]="customerLastName"
                [disabled]="loading"
                required
                placeholder="ุฃุฏุฎู ุงุณู ุนุงุฆูุชู"
              >
            </div>
          </div>
          
          <div class="form-group">
            <label for="customerEmail">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู *</label>
            <input 
              type="email" 
              id="customerEmail"
              [(ngModel)]="customerEmail"
              [disabled]="loading"
              required
              placeholder="example@email.com"
            >
          </div>
          
          <div class="form-group">
            <label for="customerPhone">ุฑูู ุงููุงุชู *</label>
            <input 
              type="tel" 
              id="customerPhone"
              [(ngModel)]="customerPhone"
              [disabled]="loading"
              required
              placeholder="0612345678"
            >
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="customerAddress">ุงูุนููุงู *</label>
              <input 
                type="text" 
                id="customerAddress"
                [(ngModel)]="customerAddress"
                [disabled]="loading"
                required
                placeholder="ุงูุดุงุฑุนุ ุงูุญู..."
              >
            </div>
            
            <div class="form-group">
              <label for="customerCity">ุงููุฏููุฉ</label>
              <input 
                type="text" 
                id="customerCity"
                [(ngModel)]="customerCity"
                [disabled]="loading"
                placeholder="ุงููุฏููุฉ"
              >
            </div>
          </div>
          
          <div class="form-group">
            <label for="orderNotes">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
            <textarea 
              id="orderNotes"
              [(ngModel)]="orderNotes"
              [disabled]="loading"
              rows="3"
              placeholder="ุฃู ููุงุญุธุงุช ุฎุงุตุฉ ุจุทูุจู..."
            ></textarea>
          </div>

          <!-- ุฑุณุงูุฉ ุฎุทุฃ -->
          <div class="error-message" *ngIf="error">
            {{ error }}
          </div>

          <!-- ุฃุฒุฑุงุฑ ุงููุงูุฐุฉ -->
          <div class="modal-actions">
            <button 
              class="cancel-button" 
              (click)="closeOfferModal()"
              [disabled]="loading"
            >
              ุฅูุบุงุก
            </button>
            <button 
              class="confirm-button" 
              (click)="submitOfferOrder()"
              [disabled]="loading || !customerFirstName || !customerLastName || !customerEmail || !customerPhone || !customerAddress"
            >
              {{ loading ? 'ุฌุงุฑู ุงูุฅุฑุณุงู...' : 'ุชุฃููุฏ ุงูุทูุจ' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
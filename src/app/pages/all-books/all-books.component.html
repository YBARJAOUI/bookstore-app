<div class="all-books-page">
  <div class="container">
    <!-- Header -->
    <div class="page-header">
      <h1>Tous les livres</h1>
      <p>D√©couvrez notre s√©lection de livres et commandez facilement</p>
    </div>

    <!-- Selection Progress -->
    <div class="selection-progress" *ngIf="selectedBooks.length > 0">
      <div class="progress-info">
        <span class="selected-count">{{ selectedBooks.length }} livres s√©lectionn√©s</span>
        <span class="total-price">{{ selectedBooks | totalPrice }} MAD</span>
      </div>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="error">
      {{ error }}
      <button class="close-error" (click)="error = ''">√ó</button>
    </div>

    <!-- Filters -->
    <div class="filters">
      <!-- Recherche textuelle -->
      <div class="search-box">
        <input 
          type="text" 
          [(ngModel)]="searchQuery" 
          (input)="onSearch()"
          placeholder="Rechercher par titre, auteur ou description..."
          class="search-input"
          [disabled]="loading"
        >
        <span class="search-icon">üîç</span>
      </div>
      
      <!-- Filtres par cat√©gorie -->
      <div class="category-filters">
        <button 
          *ngFor="let category of categories"
          [class.active]="selectedCategory === category.value"
          (click)="selectedCategory = category.value; onCategoryChange()"
          class="category-btn"
          [disabled]="loading"
        >
          {{ category.label }}
        </button>
      </div>

      <!-- Filtres par prix -->
      <div class="price-filters">
        <div class="price-range">
          <label>Prix (MAD)</label>
          <div class="price-inputs">
            <input 
              type="number" 
              [(ngModel)]="minPrice" 
              (change)="onPriceFilter()"
              placeholder="Min"
              class="price-input"
              [disabled]="loading"
            >
            <span>-</span>
            <input 
              type="number" 
              [(ngModel)]="maxPrice" 
              (change)="onPriceFilter()"
              placeholder="Max"
              class="price-input"
              [disabled]="loading"
            >
          </div>
        </div>
      </div>

      <!-- Filtre par auteur -->
      <div class="author-filter" *ngIf="books.length > 0">
        <label for="authorSelect">Auteur</label>
        <select 
          id="authorSelect"
          [(ngModel)]="selectedAuthor" 
          (change)="onSearch()"
          class="author-select"
          [disabled]="loading"
        >
          <option value="">Tous les auteurs</option>
          <option *ngFor="let author of getUniqueAuthors()" [value]="author">
            {{ author }}
          </option>
        </select>
      </div>

      <!-- Bouton pour effacer les filtres -->
      <div class="filter-actions">
        <button 
          class="clear-filters-btn" 
          (click)="clearFilters()"
          [disabled]="loading"
        >
          Effacer les filtres
        </button>
      </div>
    </div>

    <!-- Loading Spinner -->
    <div class="loading-spinner" *ngIf="loading">
      <div class="spinner"></div>
      <p>Chargement en cours...</p>
    </div>

    <!-- Books Grid -->
    <div class="books-grid" *ngIf="!loading">
      <div 
        *ngFor="let book of filteredBooks" 
        class="book-card"
        [class.selected]="isBookSelected(book)"
        (click)="toggleBookSelection(book)"
      >
        <div class="book-cover" [style.background-image]="book.image ? 'url(' + book.image + ')' : 'url(assets/images/default-book.jpg)'">
          <div class="selection-indicator" *ngIf="isBookSelected(book)">
            ‚úì
          </div>
        </div>
        
        <div class="book-info">
          <h3 class="book-title">{{ book.title }}</h3>
          <p class="book-author">{{ book.author }}</p>
          <div class="book-category" *ngIf="book.category">
            <span class="category-badge">{{ book.category }}</span>
          </div>
          <div class="book-language" *ngIf="book.language">
            <span class="language-badge">{{ book.language }}</span>
          </div>
          <p class="book-description">{{ book.description }}</p>
          <div class="book-price">
            <span class="current-price">{{ book.price }} MAD</span>
          </div>
          <div class="book-availability" *ngIf="book.isAvailable !== undefined">
            <span [class.unavailable]="!book.isAvailable">
              {{ book.isAvailable ? 'Disponible' : 'Non disponible' }}
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- Pagination -->
    <div class="pagination" *ngIf="!loading && filteredBooks.length > 0 && totalPages > 1">
      <div class="pagination-info">
        <span>Page {{ currentPage + 1 }} sur {{ totalPages }}</span>
        <span>({{ totalElements }} livres au total)</span>
      </div>
      
      <div class="pagination-controls">
        <button 
          class="pagination-btn" 
          [disabled]="currentPage === 0"
          (click)="previousPage()"
        >
          ‚Üê Pr√©c√©dent
        </button>
        
        <button 
          *ngFor="let page of displayedPages" 
          class="pagination-btn" 
          [class.active]="page === currentPage"
          (click)="goToPage(page)"
        >
          {{ page + 1 }}
        </button>
        
        <button 
          class="pagination-btn" 
          [disabled]="currentPage >= totalPages - 1"
          (click)="nextPage()"
        >
          Suivant ‚Üí
        </button>
      </div>
    </div>

    <!-- No Results -->
    <div class="no-results" *ngIf="!loading && filteredBooks.length === 0">
      <div class="no-results-content">
        <span class="no-results-icon">üìö</span>
        <h3>Aucun livre trouv√©</h3>
        <p>Essayez de modifier vos crit√®res de recherche</p>
      </div>
    </div>

    <!-- Order Button -->
    <div class="order-section" *ngIf="selectedBooks.length > 0">
      <button class="order-button" (click)="openOrderModal()" [disabled]="loading">
        Commander ({{ selectedBooks.length }} livres)
      </button>
    </div>

    <!-- Order Modal -->
    <div class="modal" *ngIf="showOrderModal">
      <div class="modal-content">
        <h2>Finaliser votre commande</h2>
        
        <div class="order-summary">
          <h3>R√©capitulatif</h3>
          <div class="summary-items">
            <div *ngFor="let book of selectedBooks" class="summary-item">
              <span>{{ book.title }}</span>
              <span>{{ book.price }} MAD</span>
            </div>
          </div>
          <div class="summary-total">
            <span>Total:</span>
            <span>{{ getTotalPrice() }} MAD</span>
          </div>
        </div>

        <!-- Success Message -->
        <div class="success-message" *ngIf="orderSuccess">
          <div class="success-icon">‚úÖ</div>
          <h3>Commande envoy√©e avec succ√®s!</h3>
          <p>Vous recevrez une confirmation par email.</p>
        </div>

        <!-- Order Form -->
        <div class="order-form" *ngIf="!orderSuccess">
          <div class="form-row">
            <div class="form-group">
              <label for="customerFirstName">Pr√©nom *</label>
              <input 
                type="text" 
                id="customerFirstName"
                [(ngModel)]="customerFirstName"
                [disabled]="loading"
                required
              >
            </div>
            
            <div class="form-group">
              <label for="customerLastName">Nom *</label>
              <input 
                type="text" 
                id="customerLastName"
                [(ngModel)]="customerLastName"
                [disabled]="loading"
                required
              >
            </div>
          </div>
          
          <div class="form-group">
            <label for="customerEmail">Email *</label>
            <input 
              type="email" 
              id="customerEmail"
              [(ngModel)]="customerEmail"
              [disabled]="loading"
              required
            >
          </div>
          
          <div class="form-group">
            <label for="customerPhone">Num√©ro de t√©l√©phone *</label>
            <input 
              type="tel" 
              id="customerPhone"
              [(ngModel)]="customerPhone"
              [disabled]="loading"
              required
            >
          </div>
          
          <div class="form-group">
            <label for="customerAddress">Adresse de livraison *</label>
            <textarea 
              id="customerAddress"
              [(ngModel)]="customerAddress"
              [disabled]="loading"
              rows="3"
              required
            ></textarea>
          </div>
          
          <div class="form-group">
            <label for="orderNotes">Notes suppl√©mentaires (optionnel)</label>
            <textarea 
              id="orderNotes"
              [(ngModel)]="orderNotes"
              [disabled]="loading"
              rows="2"
              placeholder="Instructions sp√©ciales de livraison..."
            ></textarea>
          </div>

          <div class="error-message" *ngIf="error">
            {{ error }}
          </div>

          <div class="modal-actions">
            <button 
              class="cancel-button" 
              (click)="closeOrderModal()"
              [disabled]="loading"
            >
              Annuler
            </button>
            <button 
              class="confirm-button" 
              (click)="submitOrder()"
              [disabled]="loading || !customerFirstName || !customerLastName || !customerEmail || !customerPhone || !customerAddress"
            >
              {{ loading ? 'Envoi en cours...' : 'Confirmer la commande (' + getTotalPrice() + ' MAD)' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

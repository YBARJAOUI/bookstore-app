<div class="books-page" dir="rtl">
  <div class="container">
    <!-- ุนููุงู ุงูุตูุญุฉ -->
    <div class="page-header">
      <div class="header-content">
        <div class="header-text">
          <h1>๐ ููุชุจุฉ ุงููุชุจ ุงูุฑูููุฉ</h1>
          <p>ุงูุชุดู ุนุงููุงู ูู ุงููุนุฑูุฉ ูุงูุซูุงูุฉ โข ุงุฎุชุฑ 10 ูุชุจ ุนูู ุงูุฃูู ูุงุทูุจ ุจุณูููุฉ</p>
        </div>
        <div class="header-stats">
          <div class="stat-item">
            <span class="stat-number">{{ filteredBooks.length }}+</span>
            <span class="stat-label">ูุชุงุจ ูุชุงุญ</span>
          </div>
          <div class="stat-item">
            <span class="stat-number">{{ selectedBooks.length }}</span>
            <span class="stat-label">ูุชุงุจ ูุญุฏุฏ</span>
          </div>
          <div class="stat-item" *ngIf="selectedBooks.length > 0">
            <span class="stat-number">{{ getTotalPrice() }}</span>
            <span class="stat-label">ุฏุฑูู</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ุนุฑูุถ ุฎุงุตุฉ -->
    <div class="special-offers" *ngIf="getSpecialOffers().length > 0">
      <div class="section-header">
        <h2>๐ฅ ุนุฑูุถ ุฎุงุตุฉ</h2>
        <span class="offers-count">{{ getSpecialOffers().length }} ุนุฑูุถ ูุชุงุญุฉ</span>
      </div>
      <div class="offers-carousel">
        <div 
          *ngFor="let offer of getSpecialOffers()" 
          class="offer-card"
          [class.selected]="isBookSelected(offer)"
          (click)="toggleBookSelection(offer)"
        >
          <div class="offer-badge">ุฎุตู {{ getDiscountPercent(offer) }}%</div>
          <div class="offer-image">
            <img [src]="getBookImageUrl(offer)" [alt]="offer.title">
          </div>
          <div class="offer-info">
            <h4>{{ offer.title }}</h4>
            <p class="offer-author">{{ offer.author }}</p>
            <div class="price-comparison">
              <span class="original-price">{{ getOriginalPrice(offer) }} ุฏุฑูู</span>
              <span class="offer-price">{{ offer.price }} ุฏุฑูู</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ูุคุดุฑ ุงูุชูุฏู -->
    <div class="selection-progress" *ngIf="selectedBooks.length > 0">
      <div class="progress-info">
        <span class="selected-count">{{ selectedBooks.length }} ูุชุงุจ ูุญุฏุฏ</span>
        <span class="progress-bar">
          <span class="progress-fill" [style.width.%]="(selectedBooks.length / 10) * 100"></span>
        </span>
        <span class="total-price">{{ getTotalPrice() }} ุฏุฑูู</span>
      </div>
      <div class="progress-text">
        <span *ngIf="selectedBooks.length < 10" class="remaining">
          ุชุญุชุงุฌ {{ 10 - selectedBooks.length }} ูุชุจ ุฃุฎุฑู ููุทูุจ
        </span>
        <span *ngIf="selectedBooks.length >= 10" class="ready">
          โ ููููู ุงูุขู ุฅุชูุงู ุงูุทูุจ
        </span>
      </div>
    </div>

    <!-- ุฑุณุงุฆู ุงูุฎุทุฃ -->
    <div class="error-message" *ngIf="error">
      {{ error }}
      <button class="close-error" (click)="error = ''">ร</button>
    </div>

    <!-- ุงููุฑุดุญุงุช ุงููุญุณูุฉ -->
    <div class="filters-section">
      <div class="filters-header">
        <h3>๐ ุงูุจุญุซ ูุงููุฑุดุญุงุช</h3>
        <button class="filters-toggle" (click)="toggleFilters()">
          {{ showFilters ? 'ุฅุฎูุงุก ุงููุฑุดุญุงุช' : 'ุฅุธูุงุฑ ุงููุฑุดุญุงุช' }}
        </button>
      </div>

      <!-- ุงูุจุญุซ ุงูุฑุฆูุณู -->
      <div class="main-search">
        <div class="search-container">
          <input 
            type="text" 
            [(ngModel)]="searchQuery" 
            (input)="onSearch()"
            placeholder="ุงุจุญุซ ูู ููุชุจุฉ ุงููุชุจ... (ุนููุงูุ ูุคููุ ูุตู)"
            class="search-input"
            [disabled]="loading"
          >
          <div class="search-icon">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor">
              <circle cx="11" cy="11" r="8"></circle>
              <path d="m21 21-4.35-4.35"></path>
            </svg>
          </div>
          <button *ngIf="searchQuery" class="clear-search" (click)="searchQuery = ''; onSearch()">
            ร
          </button>
        </div>
      </div>
      
      <!-- ูุฑุดุญุงุช ูุชูุฏูุฉ -->
      <div class="advanced-filters" [class.visible]="showFilters">
        <div class="filter-chips">
          <!-- ูุฑุดุญุงุช ุงููุฆุงุช ูุฑูุงุฆู -->
          <div class="filter-chip-group">
            <label class="chip-label">ุงููุฆุงุช:</label>
            <div class="chips-container">
              <button 
                *ngFor="let category of categories.slice(1)" 
                class="filter-chip"
                [class.active]="selectedCategory === category.value"
                (click)="selectCategory(category.value)"
              >
                {{ category.label }}
              </button>
            </div>
          </div>

          <!-- ูุฑุดุญุงุช ุงููุบุงุช ูุฑูุงุฆู -->
          <div class="filter-chip-group">
            <label class="chip-label">ุงููุบุงุช:</label>
            <div class="chips-container">
              <button 
                *ngFor="let language of languages.slice(1)" 
                class="filter-chip language-chip"
                [class.active]="selectedLanguage === language.value"
                (click)="selectLanguage(language.value)"
              >
                {{ language.label }}
              </button>
            </div>
          </div>

          <!-- ูุฑุดุญ ุงูุณุนุฑ ุงูุชูุงุนูู -->
          <div class="price-filter-section">
            <label class="chip-label">ูุทุงู ุงูุณุนุฑ:</label>
            <div class="price-range-container">
              <div class="price-inputs">
                <div class="price-input-group">
                  <input 
                    type="number" 
                    [(ngModel)]="minPrice" 
                    (change)="onPriceFilter()"
                    placeholder="0"
                    class="price-input"
                    [disabled]="loading"
                  >
                  <span class="input-label">ุฏุฑูู ูู</span>
                </div>
                <span class="price-separator">โ</span>
                <div class="price-input-group">
                  <input 
                    type="number" 
                    [(ngModel)]="maxPrice" 
                    (change)="onPriceFilter()"
                    placeholder="500"
                    class="price-input"
                    [disabled]="loading"
                  >
                  <span class="input-label">ุฏุฑูู ุฅูู</span>
                </div>
              </div>
            </div>
          </div>

          <!-- ุฃุฒุฑุงุฑ ุงูุนูููุงุช -->
          <div class="filter-actions">
            <button class="clear-filters-btn" (click)="clearFilters()" [disabled]="loading">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2"></path>
              </svg>
              ูุณุญ ุงููู
            </button>
            <button class="apply-filters-btn" (click)="applyFilters()" [disabled]="loading">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                <polyline points="20,6 9,17 4,12"></polyline>
              </svg>
              ุชุทุจูู ุงููุฑุดุญุงุช
            </button>
          </div>
        </div>
      </div>

      <!-- ุฅุญุตุงุฆูุงุช ุงููุชุงุฆุฌ -->
      <div class="results-summary">
        <div class="results-count">
          <span class="count-number">{{ filteredBooks.length }}</span>
          <span class="count-text">ูุชุงุจ ูุชุงุญ</span>
        </div>
        <div class="active-filters" *ngIf="hasActiveFilters()">
          <span class="filters-active">ูุฑุดุญุงุช ูุนุงูุฉ:</span>
          <span *ngIf="searchQuery" class="active-filter">ุงูุจุญุซ: "{{ searchQuery }}"</span>
          <span *ngIf="selectedCategory !== 'ุงููู'" class="active-filter">{{ getCategoryLabel(selectedCategory) }}</span>
          <span *ngIf="selectedLanguage !== 'ุงููู'" class="active-filter">{{ getLanguageLabel(selectedLanguage) }}</span>
          <span *ngIf="minPrice || maxPrice" class="active-filter">
            ุงูุณุนุฑ: {{ minPrice || 0 }}-{{ maxPrice || 'โ' }} ุฏุฑูู
          </span>
        </div>
      </div>
    </div>

    <!-- ุญุงูุฉ ุงูุชุญููู -->
    <div class="loading-spinner" *ngIf="loading">
      <div class="spinner"></div>
      <p>ุฌุงุฑู ุงูุชุญููู...</p>
    </div>

    <!-- ุดุจูุฉ ุงููุชุจ -->
    <div class="books-grid" *ngIf="!loading">
      <div 
        *ngFor="let book of filteredBooks" 
        class="book-card"
        [class.selected]="isBookSelected(book)"
        (click)="toggleBookSelection(book)"
      >
        <!-- ุตูุฑุฉ ุงููุชุงุจ -->
        <div class="book-cover">
          <img 
            [src]="getBookImageUrl(book)" 
            [alt]="book.title"
            class="book-image"
            (error)="onImageError($event)"
            loading="lazy"
          >
          <div class="selection-indicator" *ngIf="isBookSelected(book)">
            <span class="checkmark">โ</span>
          </div>
          <div class="book-price-tag">
            <span class="price-amount">{{ book.price }}</span>
            <span class="currency">ุฏุฑูู</span>
          </div>
          <div class="book-language-badge" *ngIf="book.language">
            {{ getLanguageLabel(book.language) }}
          </div>
        </div>
        
        <!-- ูุนูููุงุช ุงููุชุงุจ -->
        <div class="book-info">
          <h3 class="book-title">{{ book.title }}</h3>
          <p class="book-author">{{ book.author }}</p>
          
          <div class="book-meta">
            <span class="book-category">{{ getCategoryLabel(book.category) }}</span>
            <span class="book-language">{{ getLanguageLabel(book.language) }}</span>
          </div>

          <p class="book-description">{{ book.description }}</p>
        </div>
      </div>
    </div>

    <!-- ูุง ุชูุฌุฏ ูุชุงุฆุฌ -->
    <div class="no-results" *ngIf="!loading && filteredBooks.length === 0">
      <div class="no-results-content">
        <span class="no-results-icon">๐</span>
        <h3>ูู ูุชู ุงูุนุซูุฑ ุนูู ูุชุจ</h3>
        <p>ุฌุฑุจ ุชุนุฏูู ูุนุงููุฑ ุงูุจุญุซ</p>
      </div>
    </div>

    <!-- ุฒุฑ ุงูุทูุจ -->
    <div class="order-section" *ngIf="selectedBooks.length > 0">
      <button 
        class="order-button" 
        [class.ready]="canOrder()"
        (click)="openOrderModal()" 
        [disabled]="loading"
      >
        <span *ngIf="!canOrder()">
          ุงุฎุชุฑ {{ 10 - selectedBooks.length }} ูุชุจ ุฃุฎุฑู ({{ selectedBooks.length }}/10)
        </span>
        <span *ngIf="canOrder()">
          ุงุทูุจ ุงูุขู ({{ selectedBooks.length }} ูุชุงุจ - {{ getTotalPrice() }} ุฏุฑูู)
        </span>
      </button>
    </div>

    <!-- ูุงูุฐุฉ ุงูุทูุจ -->
    <div class="modal" *ngIf="showOrderModal" (click)="closeOrderModal()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>ุฅุชูุงู ุงูุทูุจ</h2>
        
        <!-- ููุฎุต ุงูุทูุจ -->
        <div class="order-summary">
          <h3>ููุฎุต ุทูุจู</h3>
          <div class="summary-items">
            <div *ngFor="let book of selectedBooks" class="summary-item">
              <span>{{ book.title }}</span>
              <span>{{ book.price }} ุฏุฑูู</span>
            </div>
          </div>
          <div class="summary-total">
            <span>ุงููุฌููุน:</span>
            <span>{{ getTotalPrice() }} ุฏุฑูู</span>
          </div>
        </div>

        <!-- ุฑุณุงูุฉ ุงููุฌุงุญ -->
        <div class="success-message" *ngIf="orderSuccess">
          <div class="success-icon">โ</div>
          <h3>ุชู ุฅุฑุณุงู ุทูุจู ุจูุฌุงุญ!</h3>
          <p>ุณูุชูุงุตู ูุนู ูุฑูุจุงู ูุชุฃููุฏ ุงูุทูุจ</p>
        </div>

        <!-- ูููุฐุฌ ุงูุทูุจ -->
        <div class="order-form" *ngIf="!orderSuccess">
          <div class="form-row">
            <div class="form-group">
              <label for="customerFirstName">ุงูุงุณู ุงูุฃูู *</label>
              <input 
                type="text" 
                id="customerFirstName"
                [(ngModel)]="customerFirstName"
                [disabled]="loading"
                required
                placeholder="ุฃุฏุฎู ุงุณูู ุงูุฃูู"
              >
            </div>
            
            <div class="form-group">
              <label for="customerLastName">ุงุณู ุงูุนุงุฆูุฉ *</label>
              <input 
                type="text" 
                id="customerLastName"
                [(ngModel)]="customerLastName"
                [disabled]="loading"
                required
                placeholder="ุฃุฏุฎู ุงุณู ุนุงุฆูุชู"
              >
            </div>
          </div>
          
          <div class="form-group">
            <label for="customerEmail">ุงูุจุฑูุฏ ุงูุฅููุชุฑููู *</label>
            <input 
              type="email" 
              id="customerEmail"
              [(ngModel)]="customerEmail"
              [disabled]="loading"
              required
              placeholder="example@email.com"
            >
          </div>
          
          <div class="form-group">
            <label for="customerPhone">ุฑูู ุงููุงุชู *</label>
            <input 
              type="tel" 
              id="customerPhone"
              [(ngModel)]="customerPhone"
              [disabled]="loading"
              required
              placeholder="0612345678"
            >
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="customerAddress">ุงูุนููุงู *</label>
              <input 
                type="text" 
                id="customerAddress"
                [(ngModel)]="customerAddress"
                [disabled]="loading"
                required
                placeholder="ุงูุดุงุฑุนุ ุงูุญู..."
              >
            </div>
            
            <div class="form-group">
              <label for="customerCity">ุงููุฏููุฉ</label>
              <input 
                type="text" 
                id="customerCity"
                [(ngModel)]="customerCity"
                [disabled]="loading"
                placeholder="ุงููุฏููุฉ"
              >
            </div>
          </div>
          
          <div class="form-group">
            <label for="orderNotes">ููุงุญุธุงุช ุฅุถุงููุฉ</label>
            <textarea 
              id="orderNotes"
              [(ngModel)]="orderNotes"
              [disabled]="loading"
              rows="3"
              placeholder="ุฃู ููุงุญุธุงุช ุฎุงุตุฉ ุจุทูุจู..."
            ></textarea>
          </div>

          <!-- ุฑุณุงูุฉ ุฎุทุฃ -->
          <div class="error-message" *ngIf="error">
            {{ error }}
          </div>

          <!-- ุฃุฒุฑุงุฑ ุงููุงูุฐุฉ -->
          <div class="modal-actions">
            <button 
              class="cancel-button" 
              (click)="closeOrderModal()"
              [disabled]="loading"
            >
              ุฅูุบุงุก
            </button>
            <button 
              class="confirm-button" 
              (click)="submitOrder()"
              [disabled]="loading || !customerFirstName || !customerLastName || !customerEmail || !customerPhone || !customerAddress"
            >
              {{ loading ? 'ุฌุงุฑู ุงูุฅุฑุณุงู...' : 'ุชุฃููุฏ ุงูุทูุจ (' + getTotalPrice() + ' ุฏุฑูู)' }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>